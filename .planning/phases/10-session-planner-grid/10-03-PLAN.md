---
phase: 10-session-planner-grid
plan: 03
type: execute
wave: 3
depends_on: ["10-02"]
files_modified:
  - frontend/src/pages/SessionPlannerPage.tsx
  - frontend/src/App.tsx
autonomous: false

must_haves:
  truths:
    - "4x3 grid displays with labeled rows (Activation, Dribbling, Passing, Shooting)"
    - "User can drag drills from library into grid cells on desktop"
    - "User can drag drills from library into grid cells on iPad with touch"
    - "User can click drill then click cell as alternative to dragging"
    - "User can remove drill from grid cell"
  artifacts:
    - path: "frontend/src/pages/SessionPlannerPage.tsx"
      provides: "Complete session planner with DndContext, grid, and sidebar"
      exports: ["SessionPlannerPage"]
    - path: "frontend/src/App.tsx"
      provides: "Route to /sessions/new"
      contains: "/sessions/new"
  key_links:
    - from: "frontend/src/pages/SessionPlannerPage.tsx"
      to: "@dnd-kit/core"
      via: "DndContext wrapping grid and sidebar"
      pattern: "DndContext"
    - from: "frontend/src/pages/SessionPlannerPage.tsx"
      to: "frontend/src/hooks/useSessionGrid.ts"
      via: "Grid state management"
      pattern: "useSessionGrid"
    - from: "frontend/src/pages/SessionPlannerPage.tsx"
      to: "frontend/src/hooks/useDrills.ts"
      via: "Fetching user's drills"
      pattern: "useDrills"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/pages/SessionPlannerPage.tsx"
      via: "Route /sessions/new"
      pattern: "SessionPlannerPage"
---

<objective>
Create the SessionPlannerPage that composes all grid components with DndContext and wire up routing.

Purpose: Deliver the complete session planner experience with drag-and-drop, click-to-place, and drill removal working on both desktop and iPad.
Output: Fully functional SessionPlannerPage at /sessions/new route with all SESS-01 through SESS-05 requirements met.
</objective>

<execution_context>
@/Users/seijimatsuda/.claude/get-shit-done/workflows/execute-plan.md
@/Users/seijimatsuda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-session-planner-grid/10-RESEARCH.md
@.planning/phases/10-session-planner-grid/10-01-SUMMARY.md
@.planning/phases/10-session-planner-grid/10-02-SUMMARY.md

@frontend/src/hooks/useSessionSensors.ts
@frontend/src/hooks/useSessionGrid.ts
@frontend/src/hooks/useDrills.ts
@frontend/src/components/sessions/index.ts
@frontend/src/components/layout/AppShell.tsx
@frontend/src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SessionPlannerPage with DndContext integration</name>
  <files>frontend/src/pages/SessionPlannerPage.tsx</files>
  <action>
Create `frontend/src/pages/SessionPlannerPage.tsx`:

**Imports needed:**
- DndContext, DragEndEvent, DragOverlay from @dnd-kit/core
- useSessionSensors, useSessionGrid from hooks
- useDrills from hooks, useAuth for userId
- SessionGrid, DrillLibrarySidebar from components/sessions
- DraggableDrillCard for DragOverlay
- AppShell, Container from layout components

**Component structure:**

```typescript
export function SessionPlannerPage() {
  const { user } = useAuth()
  const { data: drills = [], isLoading } = useDrills(user?.id)
  const sensors = useSessionSensors()

  const {
    gridData,
    selectedDrillId,
    placeDrill,
    removeDrill,
    selectDrill,
    handleCellClick
  } = useSessionGrid()

  // Track active drag for DragOverlay
  const [activeDrillId, setActiveDrillId] = useState<string | null>(null)

  // Create drill lookup map for efficient access
  const drillMap = useMemo(() =>
    new Map(drills.map(d => [d.id, d])),
    [drills]
  )

  function handleDragStart(event: DragStartEvent) {
    setActiveDrillId(event.active.id as string)
    // Clear click-to-place selection when starting drag
    selectDrill(null)
  }

  function handleDragEnd(event: DragEndEvent) {
    const { active, over } = event
    setActiveDrillId(null)

    if (over) {
      // Place drill in cell
      placeDrill(over.id as CellKey, active.id as string)
    }
  }

  function handleDrillClick(drillId: string) {
    // Toggle selection for click-to-place
    selectDrill(selectedDrillId === drillId ? null : drillId)
  }

  return (
    <AppShell>
      <Container as="main" className="py-6">
        <h1 className="text-2xl font-bold mb-6">Session Planner</h1>

        <DndContext
          sensors={sensors}
          onDragStart={handleDragStart}
          onDragEnd={handleDragEnd}
        >
          <div className="flex gap-6">
            {/* Grid area */}
            <div className="flex-1">
              <SessionGrid
                gridData={gridData}
                drills={drillMap}
                onCellClick={handleCellClick}
                onRemoveDrill={removeDrill}
                targetedCellKey={selectedDrillId ? 'any-empty' : null}
              />
            </div>

            {/* Sidebar */}
            <DrillLibrarySidebar
              drills={drills}
              selectedDrillId={selectedDrillId}
              onDrillClick={handleDrillClick}
              isLoading={isLoading}
            />
          </div>

          {/* Drag overlay for smooth visuals */}
          <DragOverlay>
            {activeDrillId ? (
              <DraggableDrillCard
                drill={drillMap.get(activeDrillId)!}
                isSelected={false}
                onClick={() => {}}
              />
            ) : null}
          </DragOverlay>
        </DndContext>

        {/* Instruction text */}
        <p className="mt-4 text-sm text-gray-500">
          Drag drills from the library into grid cells, or click a drill then click a cell to place it.
        </p>
      </Container>
    </AppShell>
  )
}
```

**Key implementation details:**
- DndContext wraps both sidebar and grid for unified drag handling
- DragOverlay renders floating copy during drag for polish
- Click-to-place: selectDrill toggles selection, handleCellClick places if selected
- Responsive layout: flex gap-6, grid flexes, sidebar fixed width
- Clear selection when drag starts to avoid confusion
  </action>
  <verify>
```bash
cd frontend && npx tsc --noEmit
```
No type errors. Page composes all components correctly.
  </verify>
  <done>SessionPlannerPage integrates DndContext with grid, sidebar, and both drag and click-to-place interactions</done>
</task>

<task type="auto">
  <name>Task 2: Wire routes for session planner</name>
  <files>frontend/src/App.tsx</files>
  <action>
Update `frontend/src/App.tsx`:

1. Import SessionPlannerPage:
```typescript
import { SessionPlannerPage } from './pages/SessionPlannerPage'
```

2. Add route inside protected routes section:
```typescript
{/* Session routes */}
<Route path="/sessions/new" element={<SessionPlannerPage />} />
```

3. Update placeholder for /sessions route (if exists) or add:
```typescript
<Route
  path="/sessions"
  element={
    <div className="flex items-center justify-center min-h-screen bg-gray-50">
      <div className="text-center">
        <h1 className="text-2xl font-bold text-gray-900 mb-2">
          My Sessions
        </h1>
        <p className="text-gray-600">Coming in Phase 11</p>
      </div>
    </div>
  }
/>
```

Route structure should be:
- /sessions/new -> SessionPlannerPage (create new session with grid)
- /sessions -> placeholder for session list (Phase 11)
  </action>
  <verify>
```bash
cd frontend && npx tsc --noEmit
```
No type errors. Routes compile correctly.
  </verify>
  <done>Routes added: /sessions/new points to SessionPlannerPage</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete session planner grid with:
- 4x3 grid with labeled rows (Activation, Dribbling, Passing, Shooting)
- Drag-and-drop from drill library to grid cells
- Click-to-place alternative (click drill, then click cell)
- Remove drill from cell via X button
- Works on both desktop (mouse) and iPad (touch)
  </what-built>
  <how-to-verify>
1. Start the dev server:
   ```bash
   cd frontend && npm run dev
   ```

2. Open browser at http://localhost:5173 and log in

3. Navigate to /sessions/new (or add a link from dashboard)

4. **Test SESS-01: Grid Display**
   - Verify 4x3 grid displays
   - Verify rows are labeled: Activation, Dribbling, Passing, Shooting
   - Each row has 3 cells

5. **Test SESS-02: Desktop Drag**
   - Drag a drill from sidebar to a grid cell
   - Visual feedback should show when hovering over cell
   - Drill should appear in cell after drop

6. **Test SESS-04: Click-to-Place**
   - Click a drill in sidebar (should highlight with blue ring)
   - Click an empty cell in grid
   - Drill should appear in that cell
   - Selection should clear after placement

7. **Test SESS-05: Remove Drill**
   - With a drill in a cell, click the X button
   - Drill should be removed from cell

8. **Test SESS-03: iPad Touch (if iPad available)**
   - Open same URL on iPad Safari
   - Press and hold drill for 250ms, then drag
   - Should work same as desktop

9. **Verify responsive layout:**
   - Resize browser window
   - Grid and sidebar should remain usable
  </how-to-verify>
  <resume-signal>Type "approved" if all interactions work correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
After all tasks complete:

1. TypeScript compiles:
```bash
cd frontend && npx tsc --noEmit
```

2. Dev server runs:
```bash
cd frontend && npm run dev
```

3. Route accessible at http://localhost:5173/sessions/new

4. All SESS requirements met:
- SESS-01: 4x3 grid with labeled rows
- SESS-02: Desktop drag-and-drop works
- SESS-03: iPad touch works (with 250ms delay)
- SESS-04: Click-to-place alternative works
- SESS-05: Remove drill from cell works
</verification>

<success_criteria>
- SessionPlannerPage at /sessions/new route
- DndContext wraps grid and sidebar
- Drag from sidebar to grid places drill in cell
- Click drill then click cell places drill (alternative)
- X button removes drill from cell
- Visual feedback on drag-over and selection
- 44px touch targets on interactive elements
- Works on both desktop and iPad
</success_criteria>

<output>
After completion, create `.planning/phases/10-session-planner-grid/10-03-SUMMARY.md`
</output>

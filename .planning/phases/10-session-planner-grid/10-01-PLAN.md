---
phase: 10-session-planner-grid
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/src/types/session-grid.ts
  - frontend/src/hooks/useSessionSensors.ts
  - frontend/src/hooks/useSessionGrid.ts
autonomous: true

must_haves:
  truths:
    - "dnd-kit packages are installed and importable"
    - "Grid types match database schema (GridCell, GridData)"
    - "Sensors configured for both mouse and touch with activation constraints"
  artifacts:
    - path: "frontend/src/types/session-grid.ts"
      provides: "ROW_KEYS, COL_COUNT, CellKey type, grid utilities"
      exports: ["ROW_KEYS", "COL_COUNT", "CellKey", "createEmptyGridData", "getCellKey"]
    - path: "frontend/src/hooks/useSessionSensors.ts"
      provides: "Pre-configured sensors for desktop and iPad"
      exports: ["useSessionSensors"]
    - path: "frontend/src/hooks/useSessionGrid.ts"
      provides: "Grid state management with place/remove operations"
      exports: ["useSessionGrid"]
  key_links:
    - from: "frontend/src/hooks/useSessionSensors.ts"
      to: "@dnd-kit/core"
      via: "import useSensor, MouseSensor, TouchSensor"
      pattern: "import.*from '@dnd-kit/core'"
    - from: "frontend/src/types/session-grid.ts"
      to: "frontend/src/lib/database.types.ts"
      via: "re-exports GridCell, GridData"
      pattern: "from.*database.types"
---

<objective>
Install dnd-kit and create foundational types/hooks for the session planner grid.

Purpose: Establish the drag-and-drop infrastructure with proper touch/mouse sensor configuration before building UI components.
Output: @dnd-kit installed, session grid types, sensor hook, and grid state management hook.
</objective>

<execution_context>
@/Users/seijimatsuda/.claude/get-shit-done/workflows/execute-plan.md
@/Users/seijimatsuda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-session-planner-grid/10-RESEARCH.md

@frontend/src/lib/database.types.ts
@frontend/src/hooks/useSessions.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @dnd-kit packages</name>
  <files>frontend/package.json</files>
  <action>
Install dnd-kit core packages using npm:

```bash
cd frontend && npm install @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities --legacy-peer-deps
```

Use --legacy-peer-deps because dnd-kit's peer deps specify react >=16.8.0 but the library works with React 19 (as noted in RESEARCH.md).

Expected packages to be added:
- @dnd-kit/core ^6.3.1 (DndContext, useDraggable, useDroppable, sensors)
- @dnd-kit/sortable ^10.0.0 (SortableContext, useSortable)
- @dnd-kit/utilities ^3.2.2 (CSS.Transform helpers)
  </action>
  <verify>
```bash
cd frontend && npm list @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities
```
All three packages should show installed versions.
  </verify>
  <done>@dnd-kit packages are installed in frontend/package.json</done>
</task>

<task type="auto">
  <name>Task 2: Create session grid types and utilities</name>
  <files>frontend/src/types/session-grid.ts</files>
  <action>
Create `frontend/src/types/session-grid.ts` with:

1. Re-export GridCell and GridData from database.types.ts for convenience
2. Define ROW_KEYS constant: ['activation', 'dribbling', 'passing', 'shooting'] as const
3. Define COL_COUNT constant: 3
4. Define CellKey type: Template literal type like `${RowKey}-${0 | 1 | 2}`
5. Create utility function `getCellKey(row: RowKey, col: number): CellKey`
6. Create utility function `createEmptyGridData(): GridData` - returns object with all 12 cells initialized to { drillId: null }

The 12 cell keys follow pattern: "activation-0", "activation-1", "activation-2", "dribbling-0", etc.

Type definitions:
```typescript
export type RowKey = typeof ROW_KEYS[number]
export type CellKey = `${RowKey}-${0 | 1 | 2}`
```
  </action>
  <verify>
```bash
cd frontend && npx tsc --noEmit
```
No type errors. File exports ROW_KEYS, COL_COUNT, CellKey type, utility functions.
  </verify>
  <done>Session grid types and utilities are defined with 4 rows x 3 columns structure</done>
</task>

<task type="auto">
  <name>Task 3: Create sensor and grid state hooks</name>
  <files>
frontend/src/hooks/useSessionSensors.ts
frontend/src/hooks/useSessionGrid.ts
  </files>
  <action>
**Create `frontend/src/hooks/useSessionSensors.ts`:**

Pre-configured sensors hook for drag-and-drop:
- MouseSensor with activationConstraint: { distance: 10 } (10px before drag starts)
- TouchSensor with activationConstraint: { delay: 250, tolerance: 5 } (250ms hold for iPad)
- Return useSensors(mouseSensor, touchSensor)

Use separate MouseSensor + TouchSensor (NOT PointerSensor) per RESEARCH.md recommendations.

```typescript
import { useSensor, useSensors, MouseSensor, TouchSensor } from '@dnd-kit/core'

export function useSessionSensors() {
  // ... sensor configuration
  return useSensors(mouseSensor, touchSensor)
}
```

**Create `frontend/src/hooks/useSessionGrid.ts`:**

Grid state management hook:
- Parameters: initialGridData (optional, defaults to createEmptyGridData())
- State: gridData, selectedDrillId (for click-to-place)
- Actions:
  - placeDrill(cellKey: CellKey, drillId: string) - sets drill in cell
  - removeDrill(cellKey: CellKey) - sets cell to null
  - selectDrill(drillId: string | null) - for click-to-place selection
  - handleCellClick(cellKey: CellKey) - if selectedDrillId exists, place it and clear selection
- Return: { gridData, selectedDrillId, placeDrill, removeDrill, selectDrill, handleCellClick }

Note: This hook manages LOCAL state only. Persistence to Supabase will be added in Phase 11 (Save & Load Sessions). For now, grid state resets on page refresh.
  </action>
  <verify>
```bash
cd frontend && npx tsc --noEmit
```
No type errors. Both hooks export correctly and types align.
  </verify>
  <done>useSessionSensors and useSessionGrid hooks are created with proper typing</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Verify npm packages:
```bash
cd frontend && npm list @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities
```

2. Verify TypeScript compilation:
```bash
cd frontend && npx tsc --noEmit
```

3. Verify exports work (quick import test):
```bash
cd frontend && node -e "
const ts = require('typescript');
const source = \`
import { ROW_KEYS, COL_COUNT, createEmptyGridData } from './src/types/session-grid';
import { useSessionSensors } from './src/hooks/useSessionSensors';
import { useSessionGrid } from './src/hooks/useSessionGrid';
\`;
console.log('Import syntax valid');
"
```
</verification>

<success_criteria>
- @dnd-kit/core, @dnd-kit/sortable, @dnd-kit/utilities installed in frontend
- session-grid.ts exports ROW_KEYS (4 items), COL_COUNT (3), CellKey type, utility functions
- useSessionSensors returns configured sensors for mouse and touch
- useSessionGrid manages grid state with place/remove/select operations
- All TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-session-planner-grid/10-01-SUMMARY.md`
</output>

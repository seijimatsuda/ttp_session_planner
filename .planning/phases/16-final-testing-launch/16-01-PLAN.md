---
phase: 16-final-testing-launch
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: true

must_haves:
  truths:
    - "Backend proxy returns 206 Partial Content for Range requests"
    - "Production environment variables are correctly configured"
    - "Backend health endpoint responds with 200 OK"
    - "Frontend loads without JavaScript errors"
  artifacts:
    - path: ".planning/phases/16-final-testing-launch/16-01-VERIFICATION.md"
      provides: "Pre-deployment verification results"
      contains: "Backend Proxy Range Request Test"
  key_links:
    - from: "Backend proxy"
      to: "iOS video playback"
      via: "206 Partial Content with Range headers"
      pattern: "HTTP/2 206|Accept-Ranges: bytes"
---

<objective>
Verify backend proxy Range request support and production environment configuration before browser testing

Purpose: Ensure the critical backend video proxy infrastructure works correctly in production before expending effort on browser-by-browser testing. Range request failures would cause all iOS video tests to fail.

Output: Pre-deployment verification document confirming backend readiness
</objective>

<execution_context>
@/Users/seijimatsuda/.claude/get-shit-done/workflows/execute-plan.md
@/Users/seijimatsuda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-final-testing-launch/16-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify backend proxy Range request support</name>
  <files></files>
  <action>
Test the backend proxy endpoint with curl to verify Range request handling:

1. First, identify an existing video file path from a drill in Supabase (or use a known test path pattern)
2. Execute Range request test against production backend:
   ```bash
   curl -I --range 0-99 https://ttp-session-planner.onrender.com/api/media/drills/[path-to-video].mp4
   ```
3. Verify response includes:
   - HTTP status 206 (Partial Content) - NOT 200
   - `Accept-Ranges: bytes` header
   - `Content-Range: bytes 0-99/[total]` header
   - `Content-Length: 100` header
   - `Access-Control-Expose-Headers: Content-Range, Accept-Ranges, Content-Length`

4. Test with a larger range to verify chunked streaming:
   ```bash
   curl -I --range 0-1048575 https://ttp-session-planner.onrender.com/api/media/drills/[path].mp4
   ```
   (1MB range - should return 206 with correct Content-Range)

5. Test CORS preflight:
   ```bash
   curl -X OPTIONS -H "Origin: https://ttp-session-planner.vercel.app" \
     -H "Access-Control-Request-Method: GET" \
     https://ttp-session-planner.onrender.com/api/media/drills/[path].mp4 -I
   ```
   Should return Access-Control-Allow-Origin matching frontend domain

Document results in verification file.
  </action>
  <verify>
curl -I --range 0-99 returns HTTP/2 206 with Accept-Ranges and Content-Range headers
  </verify>
  <done>
Backend proxy correctly returns 206 Partial Content for Range requests with all required CORS headers
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify production environment configuration</name>
  <files></files>
  <action>
Verify all production services are configured correctly:

1. Backend health check:
   ```bash
   curl -I https://ttp-session-planner.onrender.com/health
   ```
   Expected: HTTP 200 OK

2. Frontend load check:
   ```bash
   curl -I https://ttp-session-planner.vercel.app
   ```
   Expected: HTTP 200 OK with Content-Type: text/html

3. Supabase connectivity (via frontend - check network tab):
   - Open https://ttp-session-planner.vercel.app in browser
   - Open DevTools Network tab
   - Navigate to /login page
   - Verify no 401/403 errors to Supabase endpoints

4. Document environment verification:
   - Frontend URL: https://ttp-session-planner.vercel.app - [PASS/FAIL]
   - Backend URL: https://ttp-session-planner.onrender.com - [PASS/FAIL]
   - Backend health: /health returns 200 - [PASS/FAIL]
   - HTTPS enforced on all endpoints - [PASS/FAIL]
   - No mixed content warnings - [PASS/FAIL]

5. Check for cold start behavior:
   - If backend returns 5xx initially (Render cold start), wait 30 seconds and retry
   - Document cold start time if observed

Create verification summary document.
  </action>
  <verify>
All production endpoints return 200 OK, no mixed content warnings, no CORS errors
  </verify>
  <done>
Production environment verified: frontend loads, backend healthy, no security warnings
  </done>
</task>

<task type="auto">
  <name>Task 3: Create pre-deployment verification document</name>
  <files>.planning/phases/16-final-testing-launch/16-01-VERIFICATION.md</files>
  <action>
Create a verification document summarizing all pre-deployment checks:

```markdown
# Phase 16-01: Pre-Deployment Verification

**Verified:** [date]
**Status:** [PASS/FAIL]

## Backend Proxy Range Request Test

### Test 1: Small Range (0-99 bytes)
- Command: `curl -I --range 0-99 https://ttp-session-planner.onrender.com/api/media/drills/[path]`
- Expected: HTTP/2 206
- Actual: [result]
- Headers verified:
  - [ ] Accept-Ranges: bytes
  - [ ] Content-Range: bytes 0-99/[total]
  - [ ] Content-Length: 100
  - [ ] Access-Control-Expose-Headers includes required headers

### Test 2: Large Range (1MB)
- Command: `curl -I --range 0-1048575 ...`
- Expected: HTTP/2 206
- Actual: [result]

### Test 3: CORS Preflight
- Command: `curl -X OPTIONS ...`
- Expected: Access-Control-Allow-Origin present
- Actual: [result]

## Environment Configuration

| Check | Status | Notes |
|-------|--------|-------|
| Frontend (Vercel) loads | | |
| Backend (Render) health | | |
| HTTPS enforced | | |
| No mixed content | | |
| Supabase connectivity | | |

## Cold Start Behavior

- Backend cold start time: [X seconds / N/A]
- Impact on video playback: [none / acceptable / needs upgrade]

## Blockers

[List any issues that must be resolved before browser testing]

## Ready for Browser Testing

- [ ] All Range request tests pass
- [ ] All environment checks pass
- [ ] No critical blockers identified
```

Populate with actual test results from Tasks 1 and 2.
  </action>
  <verify>
File exists at .planning/phases/16-final-testing-launch/16-01-VERIFICATION.md with all test results documented
  </verify>
  <done>
Pre-deployment verification document created with all test results, ready for browser testing phase
  </done>
</task>

</tasks>

<verification>
- curl Range request to production backend returns 206 Partial Content
- All required CORS headers present in proxy response
- Frontend and backend health endpoints return 200 OK
- Verification document created with pass/fail status for all checks
</verification>

<success_criteria>
- Backend proxy Range request support verified (206 response)
- Production environment healthy (frontend, backend, Supabase connected)
- No blockers identified for browser testing
- Verification document created and committed
</success_criteria>

<output>
After completion, create `.planning/phases/16-final-testing-launch/16-01-SUMMARY.md`
</output>

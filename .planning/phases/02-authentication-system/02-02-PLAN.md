---
phase: 02-authentication-system
plan: 02
type: execute
wave: 2
depends_on: ["01"]
files_modified:
  - frontend/src/pages/LoginPage.tsx
  - frontend/src/pages/SignupPage.tsx
  - frontend/src/components/auth/ProtectedRoute.tsx
autonomous: true

must_haves:
  truths:
    - "User sees login form with email and password fields"
    - "User sees signup form with email and password fields"
    - "ProtectedRoute redirects unauthenticated users to /login"
    - "ProtectedRoute shows loading state while checking auth"
  artifacts:
    - path: "frontend/src/pages/LoginPage.tsx"
      provides: "Login form with email/password"
      exports: ["default"]
    - path: "frontend/src/pages/SignupPage.tsx"
      provides: "Signup form with email/password"
      exports: ["default"]
    - path: "frontend/src/components/auth/ProtectedRoute.tsx"
      provides: "Route protection component"
      exports: ["ProtectedRoute"]
  key_links:
    - from: "frontend/src/pages/LoginPage.tsx"
      to: "supabase.auth.signInWithPassword"
      via: "form submit handler"
      pattern: "signInWithPassword"
    - from: "frontend/src/pages/SignupPage.tsx"
      to: "supabase.auth.signUp"
      via: "form submit handler"
      pattern: "signUp"
    - from: "frontend/src/components/auth/ProtectedRoute.tsx"
      to: "frontend/src/contexts/AuthContext.tsx"
      via: "useAuth hook"
      pattern: "useAuth"
---

<objective>
Create the authentication UI components: LoginPage, SignupPage, and ProtectedRoute.

Purpose: Build the user-facing authentication interface. Users need forms to log in and sign up. Protected routes ensure only authenticated users access certain pages.

Output: Working login and signup pages with form validation, and a ProtectedRoute component that guards authenticated-only routes.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-authentication-system/02-RESEARCH.md
@.planning/phases/02-authentication-system/02-01-SUMMARY.md
@frontend/src/contexts/AuthContext.tsx
@frontend/src/lib/supabase.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LoginPage component</name>
  <files>
    frontend/src/pages/LoginPage.tsx
  </files>
  <action>
Create directory and file:
```bash
mkdir -p /Users/seijimatsuda/session_planner_1-22-26/frontend/src/pages
```

Create `frontend/src/pages/LoginPage.tsx`:

```tsx
import { useState } from 'react'
import { useNavigate, useLocation, Link } from 'react-router-dom'
import { supabase } from '../lib/supabase'

export default function LoginPage() {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [error, setError] = useState<string | null>(null)
  const [isLoading, setIsLoading] = useState(false)
  const navigate = useNavigate()
  const location = useLocation()

  const handleLogin = async (e: React.FormEvent) => {
    e.preventDefault()
    setIsLoading(true)
    setError(null)

    const { error } = await supabase.auth.signInWithPassword({
      email,
      password,
    })

    setIsLoading(false)

    if (error) {
      setError(error.message)
    } else {
      // Redirect to intended page or dashboard
      const from = (location.state as { from?: { pathname: string } })?.from?.pathname || '/'
      navigate(from, { replace: true })
    }
  }

  return (
    <div className="min-h-screen bg-gray-100 flex items-center justify-center px-4">
      <div className="bg-white p-8 rounded-lg shadow-md w-full max-w-md">
        <h1 className="text-2xl font-bold text-gray-900 mb-6 text-center">
          Log In
        </h1>

        <form onSubmit={handleLogin} className="space-y-4">
          <div>
            <label htmlFor="email" className="block text-sm font-medium text-gray-700 mb-1">
              Email
            </label>
            <input
              id="email"
              type="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              placeholder="your@email.com"
              required
              className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            />
          </div>

          <div>
            <label htmlFor="password" className="block text-sm font-medium text-gray-700 mb-1">
              Password
            </label>
            <input
              id="password"
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              placeholder="Your password"
              required
              className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            />
          </div>

          {error && (
            <div className="bg-red-50 text-red-700 px-4 py-3 rounded-md text-sm">
              {error}
            </div>
          )}

          <button
            type="submit"
            disabled={isLoading}
            className="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            {isLoading ? 'Logging in...' : 'Log In'}
          </button>
        </form>

        <p className="mt-6 text-center text-sm text-gray-600">
          Don't have an account?{' '}
          <Link to="/signup" className="text-blue-600 hover:underline">
            Sign up
          </Link>
        </p>
      </div>
    </div>
  )
}
```

Key implementation details:
- Uses `signInWithPassword` from Supabase
- Preserves intended destination via `location.state.from`
- Shows loading state during auth
- Displays Supabase error messages
- Links to signup page
- Styled with Tailwind (mobile-responsive)
  </action>
  <verify>
```bash
cd /Users/seijimatsuda/session_planner_1-22-26/frontend
ls src/pages/LoginPage.tsx && echo "LoginPage created"
grep -q "signInWithPassword" src/pages/LoginPage.tsx && echo "Supabase auth used"
grep -q "export default" src/pages/LoginPage.tsx && echo "Default export"
npx tsc --noEmit && echo "TypeScript compiles"
```
  </verify>
  <done>LoginPage.tsx created with email/password form and Supabase auth integration</done>
</task>

<task type="auto">
  <name>Task 2: Create SignupPage component</name>
  <files>
    frontend/src/pages/SignupPage.tsx
  </files>
  <action>
Create `frontend/src/pages/SignupPage.tsx`:

```tsx
import { useState } from 'react'
import { useNavigate, Link } from 'react-router-dom'
import { supabase } from '../lib/supabase'

export default function SignupPage() {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [confirmPassword, setConfirmPassword] = useState('')
  const [error, setError] = useState<string | null>(null)
  const [message, setMessage] = useState<string | null>(null)
  const [isLoading, setIsLoading] = useState(false)
  const navigate = useNavigate()

  const handleSignup = async (e: React.FormEvent) => {
    e.preventDefault()
    setError(null)
    setMessage(null)

    // Client-side validation
    if (password !== confirmPassword) {
      setError('Passwords do not match')
      return
    }

    if (password.length < 6) {
      setError('Password must be at least 6 characters')
      return
    }

    setIsLoading(true)

    const { data, error } = await supabase.auth.signUp({
      email,
      password,
      options: {
        emailRedirectTo: window.location.origin,
      },
    })

    setIsLoading(false)

    if (error) {
      setError(error.message)
    } else if (data.session) {
      // Email confirmation disabled - user logged in immediately
      navigate('/', { replace: true })
    } else {
      // Email confirmation enabled - user needs to check email
      setMessage('Check your email to confirm your account!')
    }
  }

  return (
    <div className="min-h-screen bg-gray-100 flex items-center justify-center px-4">
      <div className="bg-white p-8 rounded-lg shadow-md w-full max-w-md">
        <h1 className="text-2xl font-bold text-gray-900 mb-6 text-center">
          Sign Up
        </h1>

        <form onSubmit={handleSignup} className="space-y-4">
          <div>
            <label htmlFor="email" className="block text-sm font-medium text-gray-700 mb-1">
              Email
            </label>
            <input
              id="email"
              type="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              placeholder="your@email.com"
              required
              className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            />
          </div>

          <div>
            <label htmlFor="password" className="block text-sm font-medium text-gray-700 mb-1">
              Password
            </label>
            <input
              id="password"
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              placeholder="At least 6 characters"
              required
              minLength={6}
              className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            />
          </div>

          <div>
            <label htmlFor="confirmPassword" className="block text-sm font-medium text-gray-700 mb-1">
              Confirm Password
            </label>
            <input
              id="confirmPassword"
              type="password"
              value={confirmPassword}
              onChange={(e) => setConfirmPassword(e.target.value)}
              placeholder="Confirm your password"
              required
              minLength={6}
              className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            />
          </div>

          {error && (
            <div className="bg-red-50 text-red-700 px-4 py-3 rounded-md text-sm">
              {error}
            </div>
          )}

          {message && (
            <div className="bg-green-50 text-green-700 px-4 py-3 rounded-md text-sm">
              {message}
            </div>
          )}

          <button
            type="submit"
            disabled={isLoading}
            className="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            {isLoading ? 'Creating account...' : 'Sign Up'}
          </button>
        </form>

        <p className="mt-6 text-center text-sm text-gray-600">
          Already have an account?{' '}
          <Link to="/login" className="text-blue-600 hover:underline">
            Log in
          </Link>
        </p>
      </div>
    </div>
  )
}
```

Key implementation details:
- Uses `signUp` from Supabase
- Password confirmation validation
- Minimum password length check (6 chars - Supabase default)
- Handles both email confirmation enabled/disabled cases
- Shows success message or redirects based on Supabase config
- Links to login page
  </action>
  <verify>
```bash
cd /Users/seijimatsuda/session_planner_1-22-26/frontend
ls src/pages/SignupPage.tsx && echo "SignupPage created"
grep -q "signUp" src/pages/SignupPage.tsx && echo "Supabase signUp used"
grep -q "confirmPassword" src/pages/SignupPage.tsx && echo "Password confirmation"
npx tsc --noEmit && echo "TypeScript compiles"
```
  </verify>
  <done>SignupPage.tsx created with email/password form, confirmation, and Supabase auth integration</done>
</task>

<task type="auto">
  <name>Task 3: Create ProtectedRoute component</name>
  <files>
    frontend/src/components/auth/ProtectedRoute.tsx
  </files>
  <action>
Create directory and file:
```bash
mkdir -p /Users/seijimatsuda/session_planner_1-22-26/frontend/src/components/auth
```

Create `frontend/src/components/auth/ProtectedRoute.tsx`:

```tsx
import { Navigate, Outlet, useLocation } from 'react-router-dom'
import { useAuth } from '../../contexts/AuthContext'

export function ProtectedRoute() {
  const { session, isLoading } = useAuth()
  const location = useLocation()

  // Show loading state while checking auth
  // This prevents flash of unauthenticated content (FOUC)
  if (isLoading) {
    return (
      <div className="min-h-screen bg-gray-100 flex items-center justify-center">
        <div className="text-gray-600">Loading...</div>
      </div>
    )
  }

  // Redirect to login if not authenticated, preserving intended destination
  if (!session) {
    return <Navigate to="/login" replace state={{ from: location }} />
  }

  // Render child routes
  return <Outlet />
}
```

Key implementation details:
- Uses `useAuth` hook from AuthContext
- Shows loading UI while `isLoading` is true (prevents FOUC)
- Redirects to `/login` with `state.from` to preserve intended destination
- Uses `<Outlet />` to render nested child routes (React Router v6 pattern)
- `replace` prop prevents login page appearing in history
  </action>
  <verify>
```bash
cd /Users/seijimatsuda/session_planner_1-22-26/frontend
ls src/components/auth/ProtectedRoute.tsx && echo "ProtectedRoute created"
grep -q "Outlet" src/components/auth/ProtectedRoute.tsx && echo "Uses Outlet pattern"
grep -q "useAuth" src/components/auth/ProtectedRoute.tsx && echo "Uses useAuth hook"
grep -q "isLoading" src/components/auth/ProtectedRoute.tsx && echo "Handles loading state"
npx tsc --noEmit && echo "TypeScript compiles"
```
  </verify>
  <done>ProtectedRoute.tsx created with auth check, loading state, and redirect logic</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Pages directory structure:
```bash
ls -la /Users/seijimatsuda/session_planner_1-22-26/frontend/src/pages/
ls -la /Users/seijimatsuda/session_planner_1-22-26/frontend/src/components/auth/
```

2. All components have correct exports:
```bash
cd /Users/seijimatsuda/session_planner_1-22-26/frontend
grep "export default" src/pages/LoginPage.tsx
grep "export default" src/pages/SignupPage.tsx
grep "export function ProtectedRoute" src/components/auth/ProtectedRoute.tsx
```

3. TypeScript compiles:
```bash
cd /Users/seijimatsuda/session_planner_1-22-26/frontend
npx tsc --noEmit
```
</verification>

<success_criteria>
- [ ] `frontend/src/pages/LoginPage.tsx` exists with form and `signInWithPassword`
- [ ] `frontend/src/pages/SignupPage.tsx` exists with form, confirmation, and `signUp`
- [ ] `frontend/src/components/auth/ProtectedRoute.tsx` exists with Outlet pattern
- [ ] All components use `useAuth` or `supabase` correctly
- [ ] `npx tsc --noEmit` passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-authentication-system/02-02-SUMMARY.md`
</output>

---
phase: 02-authentication-system
plan: 03
type: execute
wave: 3
depends_on: ["01", "02"]
files_modified:
  - frontend/src/App.tsx
  - frontend/src/components/auth/LogoutButton.tsx
  - frontend/src/pages/DashboardPage.tsx
autonomous: false

must_haves:
  truths:
    - "User can navigate to /login and see login form"
    - "User can navigate to /signup and see signup form"
    - "Unauthenticated user accessing / is redirected to /login"
    - "Authenticated user can see dashboard at /"
    - "User can log out from any page using logout button"
  artifacts:
    - path: "frontend/src/App.tsx"
      provides: "Route configuration with protected and public routes"
      contains: "ProtectedRoute"
    - path: "frontend/src/components/auth/LogoutButton.tsx"
      provides: "Logout button component"
      exports: ["LogoutButton"]
    - path: "frontend/src/pages/DashboardPage.tsx"
      provides: "Protected home page"
      exports: ["default"]
  key_links:
    - from: "frontend/src/App.tsx"
      to: "frontend/src/components/auth/ProtectedRoute.tsx"
      via: "route element"
      pattern: "ProtectedRoute"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/pages/LoginPage.tsx"
      via: "route element"
      pattern: "LoginPage"
    - from: "frontend/src/components/auth/LogoutButton.tsx"
      to: "frontend/src/contexts/AuthContext.tsx"
      via: "useAuth signOut"
      pattern: "signOut"
---

<objective>
Wire all authentication components together: configure routes in App.tsx, create LogoutButton, and add a protected DashboardPage.

Purpose: Complete the authentication system by connecting all the pieces. This plan integrates login, signup, protected routes, and logout into a working end-to-end authentication flow.

Output: Working authentication system where users can sign up, log in, access protected pages, and log out.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-authentication-system/02-RESEARCH.md
@.planning/phases/02-authentication-system/02-01-SUMMARY.md
@.planning/phases/02-authentication-system/02-02-SUMMARY.md
@frontend/src/contexts/AuthContext.tsx
@frontend/src/pages/LoginPage.tsx
@frontend/src/pages/SignupPage.tsx
@frontend/src/components/auth/ProtectedRoute.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LogoutButton component</name>
  <files>
    frontend/src/components/auth/LogoutButton.tsx
  </files>
  <action>
Create `frontend/src/components/auth/LogoutButton.tsx`:

```tsx
import { useNavigate } from 'react-router-dom'
import { useAuth } from '../../contexts/AuthContext'

export function LogoutButton() {
  const { signOut } = useAuth()
  const navigate = useNavigate()

  const handleLogout = async () => {
    await signOut()
    navigate('/login')
  }

  return (
    <button
      onClick={handleLogout}
      className="text-gray-600 hover:text-gray-900 px-3 py-2 rounded-md text-sm font-medium"
    >
      Log out
    </button>
  )
}
```

Key implementation details:
- Uses `signOut` from useAuth hook (wraps `supabase.auth.signOut()`)
- Navigates to `/login` after logout
- Minimal styling - can be customized per usage context
  </action>
  <verify>
```bash
cd /Users/seijimatsuda/session_planner_1-22-26/frontend
ls src/components/auth/LogoutButton.tsx && echo "LogoutButton created"
grep -q "signOut" src/components/auth/LogoutButton.tsx && echo "Uses signOut"
grep -q "export function LogoutButton" src/components/auth/LogoutButton.tsx && echo "Named export"
npx tsc --noEmit && echo "TypeScript compiles"
```
  </verify>
  <done>LogoutButton.tsx created with signOut functionality and navigation</done>
</task>

<task type="auto">
  <name>Task 2: Create DashboardPage (protected home)</name>
  <files>
    frontend/src/pages/DashboardPage.tsx
  </files>
  <action>
Create `frontend/src/pages/DashboardPage.tsx`:

```tsx
import { useAuth } from '../contexts/AuthContext'
import { LogoutButton } from '../components/auth/LogoutButton'

export default function DashboardPage() {
  const { user } = useAuth()

  return (
    <div className="min-h-screen bg-gray-100">
      <nav className="bg-white shadow-sm">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex justify-between h-16 items-center">
            <div className="flex items-center">
              <h1 className="text-xl font-semibold text-gray-900">
                Soccer Session Planner
              </h1>
            </div>
            <div className="flex items-center gap-4">
              <span className="text-sm text-gray-600">
                {user?.email}
              </span>
              <LogoutButton />
            </div>
          </div>
        </div>
      </nav>

      <main className="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
        <div className="bg-white rounded-lg shadow p-6">
          <h2 className="text-2xl font-bold text-gray-900 mb-4">
            Welcome to Your Dashboard
          </h2>
          <p className="text-gray-600 mb-6">
            You are logged in as <strong>{user?.email}</strong>.
          </p>
          <p className="text-gray-500 text-sm">
            This is a placeholder dashboard. Drill library and session planner will be added in later phases.
          </p>
        </div>
      </main>
    </div>
  )
}
```

Key implementation details:
- Uses `useAuth` to get current user info
- Displays user email in nav and welcome message
- Includes LogoutButton in header (satisfies AUTH-05: logout from any page)
- Placeholder for future dashboard features
- Responsive layout with Tailwind
  </action>
  <verify>
```bash
cd /Users/seijimatsuda/session_planner_1-22-26/frontend
ls src/pages/DashboardPage.tsx && echo "DashboardPage created"
grep -q "useAuth" src/pages/DashboardPage.tsx && echo "Uses useAuth"
grep -q "LogoutButton" src/pages/DashboardPage.tsx && echo "Has LogoutButton"
grep -q "export default" src/pages/DashboardPage.tsx && echo "Default export"
npx tsc --noEmit && echo "TypeScript compiles"
```
  </verify>
  <done>DashboardPage.tsx created with user info display and LogoutButton in header</done>
</task>

<task type="auto">
  <name>Task 3: Configure routes in App.tsx</name>
  <files>
    frontend/src/App.tsx
  </files>
  <action>
Replace `frontend/src/App.tsx` with full routing configuration:

```tsx
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom'
import { ProtectedRoute } from './components/auth/ProtectedRoute'
import LoginPage from './pages/LoginPage'
import SignupPage from './pages/SignupPage'
import DashboardPage from './pages/DashboardPage'

function App() {
  return (
    <BrowserRouter>
      <Routes>
        {/* Public routes */}
        <Route path="/login" element={<LoginPage />} />
        <Route path="/signup" element={<SignupPage />} />

        {/* Protected routes */}
        <Route element={<ProtectedRoute />}>
          <Route path="/" element={<DashboardPage />} />
          {/* Add more protected routes here as features are built */}
        </Route>

        {/* Catch-all redirect */}
        <Route path="*" element={<Navigate to="/" replace />} />
      </Routes>
    </BrowserRouter>
  )
}

export default App
```

Key implementation details:
- BrowserRouter wraps all routes
- Public routes (`/login`, `/signup`) accessible without auth
- Protected routes wrapped in `<ProtectedRoute />` element
- Using Outlet pattern: child routes render inside ProtectedRoute
- Catch-all redirects unknown paths to `/` (which redirects to login if not authenticated)
- Easy to add more protected routes later (drills, sessions, etc.)
  </action>
  <verify>
```bash
cd /Users/seijimatsuda/session_planner_1-22-26/frontend
grep -q "BrowserRouter" src/App.tsx && echo "BrowserRouter configured"
grep -q "ProtectedRoute" src/App.tsx && echo "ProtectedRoute used"
grep -q "LoginPage" src/App.tsx && echo "LoginPage routed"
grep -q "SignupPage" src/App.tsx && echo "SignupPage routed"
grep -q "DashboardPage" src/App.tsx && echo "DashboardPage routed"
npx tsc --noEmit && echo "TypeScript compiles"
```
  </verify>
  <done>App.tsx configured with BrowserRouter, public routes, and protected routes</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 4: Verify complete auth flow</name>
  <what-built>
Complete authentication system:
- Sign up with email/password
- Log in with email/password
- Session persistence across refresh
- Protected route redirect
- Logout from any page
  </what-built>
  <how-to-verify>
1. Start the dev server:
   ```bash
   cd /Users/seijimatsuda/session_planner_1-22-26/frontend
   npm run dev
   ```

2. Open http://localhost:5173 in browser

3. **Test redirect (AUTH-04):**
   - You should be redirected to `/login` (not authenticated)

4. **Test signup (AUTH-01):**
   - Click "Sign up" link
   - Enter test email and password (min 6 chars)
   - Click "Sign Up"
   - Either: See success message OR get redirected to dashboard (depends on Supabase email confirmation setting)

5. **Test login (AUTH-02):**
   - If you got success message, go to `/login`
   - Enter credentials and click "Log In"
   - Should see Dashboard with your email

6. **Test session persistence (AUTH-03):**
   - Refresh the page (Cmd+R / F5)
   - Should still be on Dashboard, not redirected to login

7. **Test logout (AUTH-05):**
   - Click "Log out" button in header
   - Should be redirected to `/login`
   - Try accessing `/` directly - should redirect to `/login`
  </how-to-verify>
  <resume-signal>
Type "approved" if all 5 auth requirements work correctly.

If any issues, describe what went wrong:
- AUTH-01 (signup): [issue]
- AUTH-02 (login): [issue]
- AUTH-03 (persistence): [issue]
- AUTH-04 (redirect): [issue]
- AUTH-05 (logout): [issue]
  </resume-signal>
</task>

</tasks>

<verification>
After all tasks complete:

1. Route structure:
```bash
cd /Users/seijimatsuda/session_planner_1-22-26/frontend
grep -A 20 "Routes" src/App.tsx
```

2. All auth components exist:
```bash
ls -la /Users/seijimatsuda/session_planner_1-22-26/frontend/src/pages/
ls -la /Users/seijimatsuda/session_planner_1-22-26/frontend/src/components/auth/
ls -la /Users/seijimatsuda/session_planner_1-22-26/frontend/src/contexts/
```

3. TypeScript compiles:
```bash
cd /Users/seijimatsuda/session_planner_1-22-26/frontend
npx tsc --noEmit
```

4. Dev server runs and serves app:
```bash
cd /Users/seijimatsuda/session_planner_1-22-26/frontend
npm run dev &
sleep 5
curl -s http://localhost:5173 | head -20
kill %1 2>/dev/null
```
</verification>

<success_criteria>
- [ ] User can sign up with email and password (AUTH-01)
- [ ] User can log in with email and password (AUTH-02)
- [ ] User session persists across browser refreshes (AUTH-03)
- [ ] Unauthenticated users redirected to login when accessing protected routes (AUTH-04)
- [ ] User can log out from any page (AUTH-05)
- [ ] All routes configured correctly in App.tsx
- [ ] TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-authentication-system/02-03-SUMMARY.md`
</output>

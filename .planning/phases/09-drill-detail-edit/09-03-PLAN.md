---
phase: 09-drill-detail-edit
plan: 03
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - frontend/src/components/drills/DeleteDrillDialog.tsx
  - frontend/src/components/drills/DrillDetail.tsx
  - frontend/src/components/drills/index.ts
autonomous: true

must_haves:
  truths:
    - "User can click Delete button on drill detail page"
    - "Confirmation dialog appears before deletion"
    - "User can cancel deletion via dialog"
    - "Confirmed deletion removes drill and navigates to library"
    - "Delete action shows success toast"
  artifacts:
    - path: "frontend/src/components/drills/DeleteDrillDialog.tsx"
      provides: "Accessible confirmation dialog with Headless UI"
      min_lines: 40
  key_links:
    - from: "frontend/src/components/drills/DrillDetail.tsx"
      to: "DeleteDrillDialog"
      via: "renders dialog with open state"
      pattern: "DeleteDrillDialog"
    - from: "frontend/src/components/drills/DrillDetail.tsx"
      to: "useDeleteDrill mutation"
      via: "onConfirm triggers mutation"
      pattern: "useDeleteDrill"
---

<objective>
Add delete functionality with accessible confirmation dialog to drill detail page.

Purpose: Allow users to safely delete drills with confirmation to prevent accidental data loss.
Output: DeleteDrillDialog component and delete button on DrillDetail with full delete flow.
</objective>

<execution_context>
@/Users/seijimatsuda/.claude/get-shit-done/workflows/execute-plan.md
@/Users/seijimatsuda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-drill-detail-edit/09-RESEARCH.md
@.planning/phases/09-drill-detail-edit/09-01-SUMMARY.md

# Existing code to reference/modify
@frontend/src/components/drills/DrillDetail.tsx
@frontend/src/hooks/useDrills.ts
@frontend/src/components/ui/Button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DeleteDrillDialog component</name>
  <files>
    frontend/src/components/drills/DeleteDrillDialog.tsx
    frontend/src/components/drills/index.ts
  </files>
  <action>
1. Create DeleteDrillDialog.tsx using Headless UI Dialog components:
   - Import Dialog, DialogPanel, DialogTitle, Description from '@headlessui/react'
   - Import Button from '@/components/ui/Button'

2. Define props interface:
   ```typescript
   interface DeleteDrillDialogProps {
     isOpen: boolean;
     onClose: () => void;
     onConfirm: () => void;
     drillName: string;
     isDeleting: boolean;
   }
   ```

3. Structure the dialog:
   - Backdrop: fixed inset-0 bg-black/30 with aria-hidden="true"
   - Centered container: fixed inset-0 flex items-center justify-center p-4
   - Panel: max-w-md w-full bg-white rounded-lg p-6 shadow-xl
   - Title: "Delete Drill?" in text-lg font-semibold
   - Description: "Are you sure you want to delete "{drillName}"? This action cannot be undone."
   - Buttons: Cancel (variant="secondary") and Delete (variant="danger")
   - Cancel button disabled={isDeleting}
   - Delete button loading={isDeleting}

4. Dialog closes on:
   - Cancel button click
   - Escape key (built-in Headless UI)
   - Backdrop click (onClose prop)

5. Dialog does NOT close on:
   - Delete button click (waits for mutation via isDeleting state)

6. Add z-50 to Dialog for proper stacking over other content

7. Update index.ts to export DeleteDrillDialog
  </action>
  <verify>
- `npx tsc --noEmit` passes
- DeleteDrillDialog exports from @/components/drills
- Component uses Headless UI Dialog primitives
  </verify>
  <done>
- DeleteDrillDialog component created with Headless UI
- Accessible dialog with keyboard navigation
- Cancel and Delete buttons with loading state
- Exported from drills barrel
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Edit/Delete buttons and delete flow to DrillDetail</name>
  <files>
    frontend/src/components/drills/DrillDetail.tsx
  </files>
  <action>
1. Update DrillDetail to accept additional props:
   ```typescript
   interface DrillDetailProps {
     drill: Drill;
     onEdit: () => void;
     onDelete: () => Promise<void>;
     isDeleting: boolean;
   }
   ```

2. Add state for delete dialog:
   ```typescript
   const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);
   ```

3. Add action buttons section after metadata display:
   ```typescript
   <div className="flex gap-3 mt-8 pt-6 border-t border-gray-200">
     <Button onClick={onEdit}>Edit Drill</Button>
     <Button
       variant="danger"
       onClick={() => setIsDeleteDialogOpen(true)}
       disabled={isDeleting}
     >
       Delete Drill
     </Button>
   </div>
   ```

4. Add DeleteDrillDialog at end of component:
   ```typescript
   <DeleteDrillDialog
     isOpen={isDeleteDialogOpen}
     onClose={() => setIsDeleteDialogOpen(false)}
     onConfirm={async () => {
       await onDelete();
       setIsDeleteDialogOpen(false);
     }}
     drillName={drill.name}
     isDeleting={isDeleting}
   />
   ```

5. Update DrillDetailPage to pass the new props:
   - Import useDeleteDrill from @/hooks/useDrills
   - Import useNavigate from react-router-dom
   - Import toast from sonner
   - Create handleEdit: `() => navigate(\`/drills/${drill.id}/edit\`)`
   - Create handleDelete:
     ```typescript
     const handleDelete = async () => {
       try {
         await deleteDrill.mutateAsync(drill.id);
         toast.success("Drill deleted successfully");
         navigate("/drills");
       } catch (error) {
         toast.error("Failed to delete drill");
         throw error; // Re-throw so dialog doesn't close on error
       }
     };
     ```
   - Pass props to DrillDetail:
     ```typescript
     <DrillDetail
       drill={drill}
       onEdit={handleEdit}
       onDelete={handleDelete}
       isDeleting={deleteDrill.isPending}
     />
     ```
  </action>
  <verify>
- `npx tsc --noEmit` passes
- DrillDetail renders Edit and Delete buttons
- Delete button opens confirmation dialog
  </verify>
  <done>
- Edit button navigates to /drills/:id/edit
- Delete button shows confirmation dialog
- Confirmed delete removes drill and navigates to /drills
- Toast shows success or error feedback
- Dialog stays open if delete fails
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `cd frontend && npx tsc --noEmit`
2. Dev server runs without errors
3. Navigate to /drills/{id} - see Edit and Delete buttons
4. Click Edit - navigates to /drills/{id}/edit
5. Click Delete - confirmation dialog appears
6. Click Cancel in dialog - dialog closes, drill still exists
7. Click Delete in dialog - loading state shows, drill deleted, navigates to /drills
8. Verify drill no longer appears in library
9. Test keyboard navigation: Tab to Delete, Enter opens dialog, Escape closes
10. Test error handling: Disconnect network, try delete, see error toast
</verification>

<success_criteria>
- Delete button on detail page opens confirmation dialog
- Dialog is accessible (keyboard navigation, focus trap, screen reader)
- Cancel closes dialog without deleting
- Confirm delete removes drill, shows toast, navigates to library
- Delete mutation errors show error toast
- Edit button navigates to edit page
</success_criteria>

<output>
After completion, create `.planning/phases/09-drill-detail-edit/09-03-SUMMARY.md`
</output>

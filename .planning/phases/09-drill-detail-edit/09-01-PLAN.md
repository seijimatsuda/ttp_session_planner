---
phase: 09-drill-detail-edit
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/src/components/drills/DrillDetail.tsx
  - frontend/src/components/drills/index.ts
  - frontend/src/pages/DrillDetailPage.tsx
  - frontend/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can navigate to /drills/:id and see drill details"
    - "Detail page shows drill name, category, metadata, and media"
    - "Video plays with iOS-compatible playsInline attribute"
    - "Loading state shows skeleton placeholders"
    - "Non-existent drill ID shows user-friendly 404 message"
  artifacts:
    - path: "frontend/src/components/drills/DrillDetail.tsx"
      provides: "Detail view component with media playback"
      min_lines: 60
    - path: "frontend/src/pages/DrillDetailPage.tsx"
      provides: "Page component with useParams, loading, error states"
      min_lines: 40
  key_links:
    - from: "frontend/src/pages/DrillDetailPage.tsx"
      to: "useDrill hook"
      via: "useParams extracts id, useDrill fetches data"
      pattern: "useDrill\\(id\\)"
    - from: "frontend/src/components/drills/DrillDetail.tsx"
      to: "getProxyMediaUrl"
      via: "video src uses proxy URL for iOS"
      pattern: "getProxyMediaUrl"
---

<objective>
Create drill detail page with full metadata display and iOS-compatible video playback.

Purpose: Enable users to view complete drill information including media - foundation for edit/delete actions.
Output: DrillDetailPage route at /drills/:id with DrillDetail component showing all drill fields.
</objective>

<execution_context>
@/Users/seijimatsuda/.claude/get-shit-done/workflows/execute-plan.md
@/Users/seijimatsuda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-drill-detail-edit/09-RESEARCH.md

# Existing code to reference
@frontend/src/hooks/useDrills.ts
@frontend/src/lib/media.ts
@frontend/src/lib/database.types.ts
@frontend/src/App.tsx
@frontend/src/pages/AddDrillPage.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Headless UI and create DrillDetail component</name>
  <files>
    frontend/package.json
    frontend/src/components/drills/DrillDetail.tsx
    frontend/src/components/drills/index.ts
  </files>
  <action>
1. Install @headlessui/react (will be used for delete dialog in Plan 09-03):
   ```bash
   cd frontend && npm install @headlessui/react
   ```

2. Create DrillDetail.tsx component that displays:
   - Drill name as h1 heading
   - Video player (if video_file_path exists) using getProxyMediaUrl from @/lib/media
     - CRITICAL: Use playsInline (camelCase, capital I) for iOS compatibility
     - Include controls attribute
     - Use preload="metadata"
     - Wrap in bg-black rounded-lg container
   - Category displayed with capitalized first letter
   - Number of players (if exists)
   - Equipment as tag pills (if array has items)
   - Tags as tag pills (if array has items)
   - Reference URL as external link (if exists)

3. Component props: `{ drill: Drill }` - receives fully loaded drill object

4. Layout: max-w-4xl mx-auto px-4 py-6 with space-y-6 sections

5. Update index.ts barrel export to include DrillDetail
  </action>
  <verify>
- `cd frontend && npm ls @headlessui/react` shows 2.2.x installed
- `npx tsc --noEmit` passes
- DrillDetail exports from @/components/drills
  </verify>
  <done>
- Headless UI installed in package.json
- DrillDetail component renders all drill fields
- Video uses playsInline and proxy URL
  </done>
</task>

<task type="auto">
  <name>Task 2: Create DrillDetailPage and wire route</name>
  <files>
    frontend/src/pages/DrillDetailPage.tsx
    frontend/src/App.tsx
  </files>
  <action>
1. Create DrillDetailPage.tsx that:
   - Uses useParams<{ id: string }>() to extract drill ID from URL
   - Uses useDrill(id) hook to fetch drill data
   - Uses useNavigate() for navigation
   - Renders three states:
     a. Loading: Skeleton placeholders (react-loading-skeleton already installed)
        - Title skeleton: height 40, width 300
        - Video skeleton: height 400, rounded-lg
        - Metadata skeletons: 4-5 rows of label + value skeletons
     b. Error/Not Found: User-friendly message with "Drill Not Found" heading,
        explanation text, and Button to navigate back to /drills
     c. Success: DrillDetail component with fetched drill

2. Import Skeleton from 'react-loading-skeleton' and 'react-loading-skeleton/dist/skeleton.css'

3. Wrap content in AppShell for consistent layout

4. Add route to App.tsx:
   - Add: `<Route path="/drills/:id" element={<DrillDetailPage />} />`
   - Place AFTER /drills/new but BEFORE /drills (more specific first)
   - Import DrillDetailPage at top of file
  </action>
  <verify>
- `npx tsc --noEmit` passes
- Route /drills/:id exists in App.tsx
- Visit /drills/{valid-id} shows drill details (manual test)
- Visit /drills/nonexistent shows "Drill Not Found" (manual test)
  </verify>
  <done>
- DrillDetailPage handles loading, error, success states
- Route /drills/:id renders DrillDetailPage
- Skeleton placeholders show during loading
- 404 state shows friendly message with back button
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `cd frontend && npx tsc --noEmit`
2. Dev server runs: `cd frontend && npm run dev` starts without errors
3. Navigate to /drills/new, create a drill, note the ID
4. Navigate to /drills/{id} - drill details display with video playing
5. Navigate to /drills/nonexistent - shows "Drill Not Found" message
6. Test video playback works (plays, has controls, scrubbing works)
</verification>

<success_criteria>
- DrillDetailPage loads and displays drill data based on URL ID
- All drill metadata fields display when populated
- Video uses playsInline and proxy URL for iOS compatibility
- Loading state shows skeleton placeholders
- Error state shows user-friendly 404 message
- Route /drills/:id correctly wired in App.tsx
</success_criteria>

<output>
After completion, create `.planning/phases/09-drill-detail-edit/09-01-SUMMARY.md`
</output>

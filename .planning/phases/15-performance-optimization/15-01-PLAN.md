---
phase: 15-performance-optimization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/vite.config.ts
  - frontend/src/App.tsx
  - frontend/src/components/layout/LoadingPage.tsx
autonomous: true

must_haves:
  truths:
    - "Initial bundle is smaller due to route-based code splitting"
    - "Bundle analysis report shows vendor chunks separated"
    - "Routes lazy load when navigated to"
  artifacts:
    - path: "frontend/vite.config.ts"
      provides: "Production build configuration with manual chunks and visualizer"
      contains: "manualChunks"
    - path: "frontend/src/App.tsx"
      provides: "Route-level code splitting with React.lazy"
      contains: "lazy(() => import"
    - path: "frontend/src/components/layout/LoadingPage.tsx"
      provides: "Suspense fallback for lazy-loaded routes"
      min_lines: 15
  key_links:
    - from: "frontend/src/App.tsx"
      to: "React.lazy imports"
      via: "dynamic import()"
      pattern: "lazy\\(\\(\\) => import\\("
---

<objective>
Configure Vite for optimal production builds and implement route-based code splitting

Purpose: Reduce initial bundle size by splitting vendor libraries and lazy-loading route components, improving initial page load time
Output: Optimized vite.config.ts with vendor chunks and visualizer, App.tsx with lazy-loaded routes
</objective>

<execution_context>
@/Users/seijimatsuda/.claude/get-shit-done/workflows/execute-plan.md
@/Users/seijimatsuda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15-performance-optimization/15-RESEARCH.md

@frontend/vite.config.ts
@frontend/src/App.tsx
@frontend/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Vite production build with vendor chunks and bundle analyzer</name>
  <files>frontend/vite.config.ts, frontend/package.json</files>
  <action>
1. Install rollup-plugin-visualizer as dev dependency:
   `npm install rollup-plugin-visualizer -D`

2. Update vite.config.ts to add:
   - Import visualizer from 'rollup-plugin-visualizer'
   - Add visualizer plugin (conditional on build mode, outputs stats.html)
   - Add build.rollupOptions.output.manualChunks for:
     - 'react-vendor': ['react', 'react-dom', 'react-router-dom']
     - 'query-vendor': ['@tanstack/react-query']
     - 'supabase-vendor': ['@supabase/supabase-js', '@supabase/ssr']
     - 'dnd-vendor': ['@dnd-kit/core', '@dnd-kit/sortable', '@dnd-kit/utilities']
   - Set build.target to 'es2020' for modern browsers
   - Set resolve.extensions explicitly: ['.ts', '.tsx', '.js', '.jsx']

Keep existing plugins (react, tailwindcss) and resolve.alias intact.
  </action>
  <verify>
Run `cd frontend && npm run build` - build succeeds and stats.html is generated in frontend/ directory
  </verify>
  <done>
Vite configured with vendor chunking, bundle visualizer outputs stats.html showing separate vendor chunks
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement route-based code splitting with React.lazy</name>
  <files>frontend/src/App.tsx, frontend/src/components/layout/LoadingPage.tsx</files>
  <action>
1. Create LoadingPage.tsx in components/layout/:
   - Simple full-page loading state with centered spinner or skeleton
   - Use existing Skeleton component for consistency
   - Show "Loading..." text below skeleton
   - Use Tailwind for styling: min-h-screen, flex center, etc.

2. Update App.tsx:
   - Import { lazy, Suspense } from 'react'
   - Import LoadingPage from '@/components/layout/LoadingPage'
   - Convert all page imports to lazy:
     - const LoginPage = lazy(() => import('./pages/LoginPage'))
     - const SignupPage = lazy(() => import('./pages/SignupPage'))
     - const DashboardPage = lazy(() => import('./pages/DashboardPage'))
     - const AddDrillPage = lazy(() => import('./pages/AddDrillPage'))
     - const DrillLibraryPage = lazy(() => import('./pages/DrillLibraryPage'))
     - const DrillDetailPage = lazy(() => import('./pages/DrillDetailPage'))
     - const EditDrillPage = lazy(() => import('./pages/EditDrillPage'))
     - const SessionPlannerPage = lazy(() => import('./pages/SessionPlannerPage'))
     - const SessionsPage = lazy(() => import('./pages/SessionsPage'))
   - Wrap Routes in Suspense with LoadingPage fallback
   - Note: For lazy imports with named exports (like AddDrillPage, DrillLibraryPage),
     use: lazy(() => import('./pages/AddDrillPage').then(m => ({ default: m.AddDrillPage })))

Keep all route definitions and ProtectedRoute structure intact.
  </action>
  <verify>
1. Run `cd frontend && npm run build` - no TypeScript errors
2. Run `cd frontend && npm run dev` - app starts and routes load lazily
3. Open DevTools Network tab, navigate to different pages - verify separate chunks load on navigation
  </verify>
  <done>
All page routes lazy-loaded, LoadingPage shows during route transitions, separate chunks created per route
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify bundle splitting and document results</name>
  <files>None (verification only)</files>
  <action>
1. Run production build: `cd frontend && npm run build`
2. Open generated stats.html in browser
3. Verify bundle structure shows:
   - react-vendor chunk (React, ReactDOM, React Router)
   - query-vendor chunk (@tanstack/react-query)
   - supabase-vendor chunk (Supabase clients)
   - dnd-vendor chunk (dnd-kit)
   - Separate chunks for each lazy-loaded page
4. Note total bundle size and largest chunks for summary

Document:
- Main entry bundle size (should be significantly smaller than before)
- Vendor chunk sizes
- Page chunk sizes
  </action>
  <verify>
stats.html opens and shows expected chunk structure with vendor libraries separated from app code
  </verify>
  <done>
Bundle analysis confirms code splitting: vendor chunks separated, routes split into individual chunks
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds without errors
2. stats.html shows separate vendor chunks and lazy-loaded route chunks
3. Application loads and routes work correctly
4. DevTools Network shows chunks loading on navigation
</verification>

<success_criteria>
- Vite configured with manual chunks for vendor splitting
- Bundle visualizer generates stats.html on build
- All routes use React.lazy for code splitting
- LoadingPage provides Suspense fallback
- Build produces separate chunks for vendors and routes
</success_criteria>

<output>
After completion, create `.planning/phases/15-performance-optimization/15-01-SUMMARY.md`
</output>

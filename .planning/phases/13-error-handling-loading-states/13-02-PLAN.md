---
phase: 13-error-handling-loading-states
plan: 02
type: execute
wave: 2
depends_on: ["13-01"]
files_modified:
  - frontend/src/pages/LoginPage.tsx
  - frontend/src/pages/SignupPage.tsx
  - frontend/src/components/auth/LogoutButton.tsx
autonomous: true

must_haves:
  truths:
    - "Login errors show toast notifications instead of inline error divs"
    - "Signup errors show toast notifications instead of inline error divs"
    - "Login success shows welcome toast"
    - "Signup success shows confirmation toast"
    - "Logout shows confirmation toast"
    - "Auth buttons show loading state with spinner"
  artifacts:
    - path: "frontend/src/pages/LoginPage.tsx"
      provides: "Login page with toast notifications and Button component"
      contains: "toast.success"
    - path: "frontend/src/pages/SignupPage.tsx"
      provides: "Signup page with toast notifications and Button component"
      contains: "toast.success"
    - path: "frontend/src/components/auth/LogoutButton.tsx"
      provides: "Logout button with toast confirmation"
      contains: "toast.success"
  key_links:
    - from: "frontend/src/pages/LoginPage.tsx"
      to: "frontend/src/lib/errors.ts"
      via: "getUserFriendlyError import"
      pattern: "getUserFriendlyError"
    - from: "frontend/src/pages/SignupPage.tsx"
      to: "frontend/src/lib/errors.ts"
      via: "getUserFriendlyError import"
      pattern: "getUserFriendlyError"
---

<objective>
Standardize auth pages to use toast notifications, UI components, and the error helper from Plan 01.

Purpose: Currently LoginPage and SignupPage use inline error divs and native HTML elements. This creates inconsistency with the rest of the app (DrillForm uses toasts). Standardizing improves UX and maintainability.

Output: Auth pages using Button/Input components, toast.success/error for feedback, and getUserFriendlyError for error messages.
</objective>

<execution_context>
@/Users/seijimatsuda/.claude/get-shit-done/workflows/execute-plan.md
@/Users/seijimatsuda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-error-handling-loading-states/13-RESEARCH.md
@.planning/phases/13-error-handling-loading-states/13-01-SUMMARY.md
@frontend/src/pages/LoginPage.tsx
@frontend/src/pages/SignupPage.tsx
@frontend/src/components/auth/LogoutButton.tsx
@frontend/src/components/ui/Button.tsx
@frontend/src/components/ui/Input.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update LoginPage with toasts and UI components</name>
  <files>frontend/src/pages/LoginPage.tsx</files>
  <action>
Update LoginPage.tsx to:

1. Import required dependencies:
   - `import { toast } from 'sonner'`
   - `import { Button } from '@/components/ui/Button'`
   - `import { Input } from '@/components/ui/Input'`
   - `import { getUserFriendlyError } from '@/lib/errors'`

2. Remove the `error` state variable (no longer needed for inline display)

3. Update handleLogin function:
   - On error: `toast.error(getUserFriendlyError(error))`
   - On success: `toast.success('Welcome back!')` then navigate
   - Remove `setError(error.message)` calls

4. Replace native `<input>` elements with `<Input>` component:
   - Email input: `<Input label="Email" type="email" value={email} onChange={(e) => setEmail(e.target.value)} placeholder="your@email.com" required disabled={isLoading} />`
   - Password input: `<Input label="Password" type="password" value={password} onChange={(e) => setPassword(e.target.value)} placeholder="Your password" required disabled={isLoading} />`

5. Remove the inline error div: `{error && (<div className="bg-red-50...">...)}`

6. Replace native `<button>` with `<Button>` component:
   ```tsx
   <Button type="submit" loading={isLoading} className="w-full">
     Log In
   </Button>
   ```
   - Remove manual disabled state and loading text handling (Button handles it)

Keep the rest of the layout (container, heading, signup link) unchanged.
  </action>
  <verify>
- `cd frontend && npx tsc --noEmit` passes
- File imports toast from sonner
- File imports getUserFriendlyError from @/lib/errors
- No inline error div present
- Uses Button component with loading prop
- Uses Input component for email and password
  </verify>
  <done>
- LoginPage uses toast.error for auth failures
- LoginPage uses toast.success on successful login
- LoginPage uses Button component with loading state
- LoginPage uses Input components for form fields
- No inline error display remains
  </done>
</task>

<task type="auto">
  <name>Task 2: Update SignupPage with toasts and UI components</name>
  <files>frontend/src/pages/SignupPage.tsx</files>
  <action>
Update SignupPage.tsx to:

1. Import required dependencies:
   - `import { toast } from 'sonner'`
   - `import { Button } from '@/components/ui/Button'`
   - `import { Input } from '@/components/ui/Input'`
   - `import { getUserFriendlyError } from '@/lib/errors'`

2. Remove `error` state variable (keep `message` state for email confirmation message)

3. Update handleSignup function:
   - Client-side validation errors: use `toast.error()` instead of setError
     - "Passwords do not match" -> `toast.error('Passwords do not match')`
     - "Password must be at least 6 characters" -> `toast.error('Password must be at least 6 characters')`
   - Supabase errors: `toast.error(getUserFriendlyError(error))`
   - On success with session (no email confirmation): `toast.success('Account created!')` then navigate
   - On success without session (email confirmation): keep inline message OR use toast.info

4. Replace native `<input>` elements with `<Input>` component:
   - Email: `<Input label="Email" type="email" value={email} onChange={(e) => setEmail(e.target.value)} placeholder="your@email.com" required disabled={isLoading} />`
   - Password: `<Input label="Password" type="password" value={password} onChange={(e) => setPassword(e.target.value)} placeholder="At least 6 characters" required disabled={isLoading} />`
   - Confirm Password: `<Input label="Confirm Password" type="password" value={confirmPassword} onChange={(e) => setConfirmPassword(e.target.value)} placeholder="Confirm your password" required disabled={isLoading} />`

5. Remove the inline error div. Keep the success message div for email confirmation flow (users need to see this persistently, not as a toast).

6. Replace native `<button>` with `<Button>`:
   ```tsx
   <Button type="submit" loading={isLoading} className="w-full">
     Sign Up
   </Button>
   ```
  </action>
  <verify>
- `cd frontend && npx tsc --noEmit` passes
- File imports toast from sonner
- File imports getUserFriendlyError from @/lib/errors
- No inline error div present
- Email confirmation message still shows inline (acceptable for this flow)
- Uses Button and Input components
  </verify>
  <done>
- SignupPage uses toast.error for validation and auth failures
- SignupPage uses toast.success on successful signup (when session exists)
- SignupPage uses Button component with loading state
- SignupPage uses Input components for form fields
- Email confirmation message still displays inline for visibility
  </done>
</task>

<task type="auto">
  <name>Task 3: Update LogoutButton with toast confirmation</name>
  <files>frontend/src/components/auth/LogoutButton.tsx</files>
  <action>
Update LogoutButton.tsx to:

1. Import toast:
   - `import { toast } from 'sonner'`

2. Update handleLogout to show confirmation:
   ```tsx
   const handleLogout = async () => {
     await signOut()
     toast.success('You have been logged out')
     navigate('/login')
   }
   ```

3. Optionally wrap in try/catch for error handling:
   ```tsx
   const handleLogout = async () => {
     try {
       await signOut()
       toast.success('You have been logged out')
       navigate('/login')
     } catch (error) {
       toast.error('Failed to log out. Please try again.')
     }
   }
   ```

Keep the existing button styling (this is a nav button, not a form submit button).
  </action>
  <verify>
- `cd frontend && npx tsc --noEmit` passes
- File imports toast from sonner
- handleLogout calls toast.success after signOut
  </verify>
  <done>
- LogoutButton shows toast.success on successful logout
- LogoutButton handles potential errors gracefully
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors:
   ```bash
   cd frontend && npx tsc --noEmit
   ```
2. Verify toast imports in all files:
   ```bash
   grep -l "import.*toast.*from 'sonner'" frontend/src/pages/LoginPage.tsx frontend/src/pages/SignupPage.tsx frontend/src/components/auth/LogoutButton.tsx
   ```
3. Verify getUserFriendlyError usage in auth pages:
   ```bash
   grep "getUserFriendlyError" frontend/src/pages/LoginPage.tsx frontend/src/pages/SignupPage.tsx
   ```
4. Verify no inline error divs remain (should only find success message in SignupPage):
   ```bash
   grep -n "bg-red-50" frontend/src/pages/LoginPage.tsx frontend/src/pages/SignupPage.tsx
   ```
</verification>

<success_criteria>
- [ ] LoginPage uses toast.error for auth errors with getUserFriendlyError
- [ ] LoginPage uses toast.success on login
- [ ] LoginPage uses Button component with loading prop
- [ ] LoginPage uses Input components
- [ ] SignupPage uses toast.error for validation/auth errors
- [ ] SignupPage uses toast.success on signup (when session exists)
- [ ] SignupPage uses Button and Input components
- [ ] LogoutButton shows toast.success on logout
- [ ] All files compile without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/13-error-handling-loading-states/13-02-SUMMARY.md`
</output>

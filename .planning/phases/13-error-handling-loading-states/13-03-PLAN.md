---
phase: 13-error-handling-loading-states
plan: 03
type: execute
wave: 2
depends_on: []
files_modified:
  - frontend/src/components/MediaUpload.tsx
autonomous: true

must_haves:
  truths:
    - "Media upload success shows toast notification"
    - "Media upload errors show toast notification"
    - "Media delete success shows toast notification"
    - "Media delete errors show toast notification"
  artifacts:
    - path: "frontend/src/components/MediaUpload.tsx"
      provides: "MediaUpload with toast notifications"
      contains: "toast.success"
  key_links:
    - from: "frontend/src/components/MediaUpload.tsx"
      to: "sonner"
      via: "toast import"
      pattern: "import.*toast.*from 'sonner'"
---

<objective>
Add toast notifications to MediaUpload component for upload and delete operations.

Purpose: Currently MediaUpload shows inline error messages but no success feedback. Users should receive clear confirmation when uploads complete and clearer error feedback via toasts (consistent with rest of app).

Output: MediaUpload component that shows toast.success on upload/delete completion and toast.error on failures.
</objective>

<execution_context>
@/Users/seijimatsuda/.claude/get-shit-done/workflows/execute-plan.md
@/Users/seijimatsuda/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-error-handling-loading-states/13-RESEARCH.md
@frontend/src/components/MediaUpload.tsx
@frontend/src/hooks/useMediaUpload.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add toast notifications to MediaUpload</name>
  <files>frontend/src/components/MediaUpload.tsx</files>
  <action>
Update MediaUpload.tsx to add toast notifications:

1. Import toast at the top of the file:
   ```tsx
   import { toast } from 'sonner'
   ```

2. Update the useMediaUpload options to show success toast:
   ```tsx
   const { upload, cancel, progress, isUploading, error, reset } = useMediaUpload({
     onSuccess: async (filePath, type) => {
       setUploadedFilePath(filePath)
       setMediaType(type)
       // Show success toast
       toast.success('File uploaded successfully!')
       // Get signed URL for preview
       try {
         const url = await getSignedUrl(filePath)
         setPreviewUrl(url)
       } catch (err) {
         console.error('Failed to get preview URL:', err)
       }
       onUploadComplete?.(filePath, type)
     },
     onError: (errorMessage) => {
       // Show error toast (useMediaUpload already provides user-friendly messages)
       toast.error(errorMessage)
     }
   })
   ```

3. Update handleDelete to show toast notifications:
   ```tsx
   const handleDelete = useCallback(async () => {
     if (!uploadedFilePath) return

     setIsDeleting(true)
     setDeleteError(null)

     try {
       await deleteFile(uploadedFilePath)
       setUploadedFilePath(null)
       setMediaType(null)
       setPreviewUrl(null)
       reset()
       toast.success('File deleted')
       onDelete?.()
     } catch (err) {
       console.error('Delete failed:', err)
       const errorMsg = err instanceof Error ? err.message : 'Delete failed'
       setDeleteError(errorMsg)
       toast.error(errorMsg)
     } finally {
       setIsDeleting(false)
     }
   }, [uploadedFilePath, reset, onDelete])
   ```

Keep the existing inline error displays as well - they provide persistent visibility for the "Try again" button context. The toast provides immediate feedback, the inline error persists for action.

Note: The useMediaUpload hook already provides user-friendly error messages (e.g., "Invalid file", "You must be logged in", "Upload failed"), so we can use them directly without getUserFriendlyError.
  </action>
  <verify>
- `cd frontend && npx tsc --noEmit` passes
- File imports toast from sonner
- onSuccess callback includes toast.success
- onError callback includes toast.error
- handleDelete includes toast.success and toast.error
  </verify>
  <done>
- MediaUpload shows toast.success when upload completes
- MediaUpload shows toast.error when upload fails
- MediaUpload shows toast.success when delete completes
- MediaUpload shows toast.error when delete fails
- Inline error displays remain for "Try again" context
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors:
   ```bash
   cd frontend && npx tsc --noEmit
   ```
2. Verify toast import:
   ```bash
   grep "import.*toast.*from 'sonner'" frontend/src/components/MediaUpload.tsx
   ```
3. Verify toast.success and toast.error calls exist:
   ```bash
   grep -n "toast\." frontend/src/components/MediaUpload.tsx
   ```
</verification>

<success_criteria>
- [ ] MediaUpload imports toast from sonner
- [ ] Upload success triggers toast.success
- [ ] Upload error triggers toast.error
- [ ] Delete success triggers toast.success
- [ ] Delete error triggers toast.error
- [ ] TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/13-error-handling-loading-states/13-03-SUMMARY.md`
</output>
